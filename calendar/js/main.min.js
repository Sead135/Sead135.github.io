const getCurrentTheme=()=>document.body.classList.contains("light")?"light":"dark",selectedTheme=localStorage.getItem("selected-theme");"light"===selectedTheme&&(document.querySelector("body").classList.add("light"),document.querySelector("body").classList.remove("dark"),document.querySelector(".dark-mode").innerText="Dark Mode"),"dark"===selectedTheme&&(document.querySelector("body").classList.add("dark"),document.querySelector("body").classList.remove("light"),document.querySelector(".dark-mode").innerText="Light Mode"),document.querySelector(".dark-mode__switch").onclick=()=>{document.querySelector("body").classList.toggle("dark"),document.querySelector("body").classList.contains("dark")&&(document.querySelector(".dark-mode").innerText="Light Mode"),document.querySelector("body").classList.toggle("light"),document.querySelector("body").classList.contains("light")&&(document.querySelector(".dark-mode").innerText="Dark Mode"),localStorage.setItem("selected-theme",document.body.classList.contains("light")?"light":"dark")};let nav=0,clicked=null,events=localStorage.getItem("events")?JSON.parse(localStorage.getItem("events")):[];const calendar=document.querySelector(".calendar__day"),weekdays=["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],eventModal=document.querySelector(".events"),eventTitleInput=document.querySelector(".event__input"),openFullModal=document.querySelector(".events__open-btn");function openModal(e){clicked=e;const t=events.filter(e=>e.date===clicked),n=document.querySelector(".event__box");n.innerHTML="";for(let e=0;e<t.length;e++)n.innerHTML+=`<div class="event__list">\n                                    <p class="event__text">${e+1}) ${t[e].title}</p>\n                                    <button class="event__del">Удалить</button>\n                                </div>`;document.querySelectorAll(".event__del").forEach((n,l)=>n.addEventListener("click",()=>{deleteEvent(t[l].title,t[l].date),load(),openModal(e)})),eventModal.style.display="block",document.querySelector(".event__add-btn").addEventListener("click",()=>{saveEvent(e)}),addEventListener("keydown",t=>{13==t.keyCode&&saveEvent(e)})}function saveEvent(e){eventTitleInput.value&&(events.push({date:clicked,title:eventTitleInput.value}),localStorage.setItem("events",JSON.stringify(events))),load(),eventModal.style.display="none",eventTitleInput.value="",clicked=null,openModal(e)}function load(){const e=new Date;0!==nav&&e.setMonth((new Date).getMonth()+nav);const t=e.getDate(),n=e.getMonth(),l=e.getFullYear(),o=new Date(l,n,1),a=new Date(l,n+1,0).getDate(),c=o.toLocaleDateString("ru-RU",{weekday:"long",year:"numeric",month:"numeric",day:"numeric"}),d=c[0].toUpperCase()+c.substr(1).toLowerCase(),s=weekdays.indexOf(d.split(", ")[0]),r=e.toLocaleDateString("ru-Ru",{month:"long"})[0].toUpperCase()+e.toLocaleDateString("ru-Ru",{month:"long"}).substr(1).toLowerCase();document.getElementById("year").innerText=""+l,document.getElementById("calendar-month").innerText=""+r,calendar.innerText="";for(let e=1;e<=s+a;e++){const o=document.createElement("div");o.classList.add("calendar__day-item");const a=`${e-s} / ${n+1} / ${l}`;if(e>s){o.innerText=e-s,o.innerHTML+="<span></span>\n                            <span></span>\n                            <span></span>\n                            <span></span>";const n=events.filter(e=>e.date===a);e-s===t&&0===nav&&(o.id="currentDay");const l=document.createElement("div");if(l.classList.add("calendar__dot"),n.length>0&&n.length<4)for(let e=1;e<=n.length;e++)l.innerHTML+='<div class="calendar__event-dot"></div>';n.length>3&&(l.innerHTML+='<div class="calendar__event-line"></div>'),o.appendChild(l),o.addEventListener("click",()=>{openModal(a)});let c=document.querySelector(".calendar__day"),d=document.querySelectorAll(".calendar__day-item");c.addEventListener("click",e=>{let t=e.target;if(t.classList.contains("calendar__day-item")){for(let e=0;e<d.length;e++)d[e].classList.remove("active");t.classList.add("active")}})}calendar.appendChild(o)}}function closeModal(){eventTitleInput.classList.remove("error"),eventModal.style.display="none",eventModal.classList.remove("full-screen"),eventTitleInput.value="",clicked=null,load()}function deleteEvent(e,t){events=events.filter(n=>n.title!==e||n.date!==t),localStorage.setItem("events",JSON.stringify(events))}function initButton(){document.getElementById("next-month").addEventListener("click",()=>{nav++,load()}),addEventListener("keydown",e=>{37==e.keyCode&&(nav--,load()),39==e.keyCode&&(nav++,load())},{passive:!0}),document.getElementById("prev-month").addEventListener("click",()=>{nav--,load()})}if(openFullModal.addEventListener("click",()=>{eventModal.classList.toggle("full-screen")}),document.querySelector(".event__close-btn").addEventListener("click",()=>{closeModal()}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const e=document.createElement("div");e.classList.add("screen"),e.innerHTML="<div class=\"screen__inner\">\n                            <img class='screen__img' src='img/rotate_screen.gif' alt='Переворот экрана'>\n                            <h3 class=\"screen__text\">Пожалуйста, переверните устройство!</h3>\n                        </div>",document.body.prepend(e),window.addEventListener("orientationchange",(function(){window.orientation>45||window.orientation<-45?document.querySelector(".screen").style.display="block":document.querySelector(".screen").style.display="none"}),!1),calendar.addEventListener("touchstart",handleTouchStart,{passive:!0}),calendar.addEventListener("touchmove",handleTouchMove,{passive:!0});let t=null,n=null;function handleTouchStart(e){const l=e.touches[0];t=l.clientX,n=l.clientY}function handleTouchMove(e){if(!t||!n)return!1;let l=e.touches[0].clientX,o=e.touches[0].clientY,a=l-t,c=o-n;Math.abs(a)>Math.abs(c)&&(a>0?(nav--,load()):(nav++,load())),t=null,n=null}eventModal.addEventListener("touchstart",eventTouchStart,{passive:!0}),eventModal.addEventListener("touchmove",eventTouchMove,{passive:!0});let l=null,o=null;function eventTouchStart(e){const t=e.touches[0];l=t.clientX,o=t.clientY}function eventTouchMove(e){if(!l||!o)return!1;let t=e.touches[0].clientX,n=e.touches[0].clientY,a=t-l,c=n-o;Math.abs(a)<Math.abs(c)&&(c>0?eventModal.classList.remove("full-screen"):eventModal.classList.add("full-screen")),l=null,o=null}}load(),initButton();